<!-- orders/templates/orders/email/customer_confirmation.html -->

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç</title>
</head>
<body style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; background-color: #f4f4f4; margin: 0; padding: 0; color: #333;">

    <div style="max-width: 600px; margin: 20px auto; background-color: #ffffff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05);">

        <!-- –®–∞–ø–∫–∞ -->
        <div style="background-color: #28a745; padding: 25px; text-align: center; color: #ffffff;">
            <h1 style="margin: 0; font-size: 24px; font-weight: 700;">–ó–∞–∫–∞–∑ #{{ order.id }} –ø—Ä–∏–Ω—è—Ç!</h1>
            <p style="margin: 5px 0 0; opacity: 0.9; font-size: 14px;">–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –≤—ã–±–æ—Ä</p>
        </div>

        <div style="padding: 30px;">
            <p style="font-size: 16px; line-height: 1.5; margin-top: 0;">
                –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, <strong>{{ order.first_name }}</strong>! <br>
                –ú—ã —É–∂–µ –ø–æ–ª—É—á–∏–ª–∏ –≤–∞—à –∑–∞–∫–∞–∑ –≤ –º–∞–≥–∞–∑–∏–Ω–µ <strong>{{ site_settings.shop_name }}</strong> –∏ –Ω–∞—á–∞–ª–∏ –µ–≥–æ —Å–±–æ—Ä–∫—É.
            </p>

            <hr style="border: 0; border-top: 1px solid #eee; margin: 25px 0;">

            <!-- –ë–ª–æ–∫: –î–ï–¢–ê–õ–ò –î–û–°–¢–ê–í–ö–ò -->
            <table style="width: 100%; border-collapse: collapse;">
                <tr>
                    <td style="vertical-align: top; padding-bottom: 20px; width: 50%;">
                        <h3 style="margin: 0 0 8px; font-size: 13px; text-transform: uppercase; color: #999; letter-spacing: 1px;">–ö–æ–≥–¥–∞</h3>

                        <p style="margin: 0 0 5px; font-size: 16px; font-weight: bold; color: #333;">
                            {% if order.delivery_time == 'asap' %}
                                üöÄ –ö–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ
                            {% else %}
                                {{ order.delivery_date|date:"d E Y" }}
                            {% endif %}
                        </p>

                        <p style="margin: 0; font-size: 14px; color: #555;">
                            {% if order.delivery_time == 'asap' %}
                                (–ü—Ä–∏–º–µ—Ä–Ω–æ {{ site_settings.processing_time|default:60 }}-{{ site_settings.processing_time|default:60|add:30 }} –º–∏–Ω)
                            {% else %}
                                –ò–Ω—Ç–µ—Ä–≤–∞–ª: <strong>{{ order.delivery_time }}</strong>
                            {% endif %}
                        </p>
                    </td>

                    <td style="vertical-align: top; padding-bottom: 20px; width: 50%;">
                        <h3 style="margin: 0 0 8px; font-size: 13px; text-transform: uppercase; color: #999; letter-spacing: 1px;">–ö—É–¥–∞</h3>

                        {% if order.delivery_option == 'delivery' %}
                            <p style="margin: 0 0 5px; font-size: 16px; font-weight: bold; color: #e53935;">
                                –ö—É—Ä—å–µ—Ä—Å–∫–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞
                            </p>
                            <p style="margin: 0; font-size: 14px; color: #555; line-height: 1.4;">
                                {{ order.city }}, {{ order.address }}
                            </p>
                        {% else %}
                            <p style="margin: 0 0 5px; font-size: 16px; font-weight: bold; color: #007bff;">
                                –°–∞–º–æ–≤—ã–≤–æ–∑
                            </p>
                            <p style="margin: 0; font-size: 14px; color: #555; line-height: 1.4;">
                                {{ site_settings.pickup_address }}
                            </p>
                        {% endif %}
                    </td>
                </tr>
            </table>

            <!-- –ü–æ–ª—É—á–∞—Ç–µ–ª—å (–µ—Å–ª–∏ –¥—Ä—É–≥–æ–π) -->
            {% if order.recipient_name %}
            <div style="background-color: #fff8e1; padding: 15px; border-radius: 8px; margin-bottom: 25px; border: 1px solid #ffe082;">
                <div style="font-weight: bold; color: #856404; margin-bottom: 3px;">üéÅ –ü–æ–ª—É—á–∞—Ç–µ–ª—å —Å—é—Ä–ø—Ä–∏–∑–∞:</div>
                <div style="font-size: 15px;">{{ order.recipient_name }}</div>
                <div style="font-size: 13px; color: #666; margin-top: 2px;">{{ order.recipient_phone }}</div>
            </div>
            {% endif %}

            <h3 style="margin: 0 0 15px; font-size: 18px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞</h3>

            <table style="width: 100%; border-collapse: collapse;">
                {% for item in order.items.all %}
                    <tr style="border-bottom: 1px solid #f9f9f9;">
                        <td style="padding: 12px 0; vertical-align: middle;">
                            <!-- –§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞ -->
                            {% if item.product.image %}
                                <div style="float: left; width: 50px; height: 50px; margin-right: 15px; border-radius: 6px; background-image: url('{{ base_url }}{{ item.product.image.url }}'); background-size: cover; background-position: center; border: 1px solid #eee;"></div>
                            {% endif %}

                            <div style="overflow: hidden;">
                                <div style="font-weight: 600; font-size: 15px; margin-bottom: 4px; color: #333;">
                                    {{ item.product.name }}

                                    <!-- –Ø–†–ö–ò–ô –ë–ï–ô–î–ñ –ö–û–õ–ò–ß–ï–°–¢–í–ê -->
                                    {% if item.quantity > 1 %}
                                        <span style="display: inline-block; background-color: #ffebee; color: #c62828; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; margin-left: 5px; border: 1px solid #ffcdd2; vertical-align: middle;">
                                            {{ item.quantity }} —à—Ç.
                                        </span>
                                    {% endif %}
                                </div>
                                <div style="font-size: 13px; color: #888;">
                                    –¶–µ–Ω–∞ –∑–∞ —à—Ç: {{ item.price }} ‚ÇΩ
                                </div>
                            </div>
                        </td>
                        <td style="text-align: right; padding: 12px 0; white-space: nowrap; font-weight: 600; font-size: 15px;">
                            {{ item.get_cost }} ‚ÇΩ
                        </td>
                    </tr>
                {% endfor %}
            </table>

            <!-- –ë–ª–æ–∫ –û—Ç–∫—Ä—ã—Ç–∫–∏ -->
            {% if order.postcard or order.custom_postcard_image %}
            <div style="margin-top: 25px; padding: 15px; background: #f0f8ff; border: 1px dashed #b8daff; border-radius: 8px;">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                    <div>
                        <span style="font-size: 1.4em; vertical-align: middle; margin-right: 5px;">üíå</span>
                        <strong style="color: #004085;">–û—Ç–∫—Ä—ã—Ç–∫–∞:</strong>
                        <span style="color: #333;">
                            {% if order.custom_postcard_image %}
                                üì∏ –°–≤–æ—ë —Ñ–æ—Ç–æ
                                {% if order.postcard %}
                                    + –æ—Å–Ω–æ–≤–∞ "{{ order.postcard.title }}"
                                {% endif %}
                            {% else %}
                                {{ order.postcard.title }}
                            {% endif %}
                        </span>
                    </div>
                    <div>
                        {% if order.postcard_final_price > 0 %}
                            <strong>{{ order.postcard_final_price }} ‚ÇΩ</strong>
                        {% else %}
                            <span style="color: #28a745; font-weight: bold; font-size: 13px; text-transform: uppercase;">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                        {% endif %}
                    </div>
                </div>

                <!-- –¢–ï–ö–°–¢ –ü–û–ó–î–†–ê–í–õ–ï–ù–ò–Ø -->
                {% if order.postcard_text %}
                    <div style="background-color: #fff; padding: 12px; border-radius: 6px; border: 1px solid #e1e8ed; font-style: italic; color: #555; font-size: 14px; line-height: 1.5;">
                        <div style="font-size: 11px; color: #999; font-style: normal; margin-bottom: 4px; text-transform: uppercase;">–¢–µ–∫—Å—Ç –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è:</div>
                        "{{ order.postcard_text|linebreaksbr }}"
                    </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- –ò–¢–û–ì–û -->
            <div style="margin-top: 30px; text-align: right;">
                <p style="margin: 5px 0; color: #666; font-size: 14px;">–¢–æ–≤–∞—Ä—ã: {{ order.get_items_cost }} ‚ÇΩ</p>

                {% if order.discount > 0 %}
                    <p style="margin: 5px 0; color: #28a745; font-size: 14px;">
                        –°–∫–∏–¥–∫–∞ ({{ order.promo_code.code|default:"PROMO" }}): -{{ order.get_discount_amount|floatformat:0 }} ‚ÇΩ
                    </p>
                {% endif %}

                <!-- –¶–ï–ù–ê –û–¢–ö–†–´–¢–ö–ò -->
                {% if order.postcard_final_price > 0 %}
                    <p style="margin: 5px 0; color: #666; font-size: 14px;">
                        –û—Ç–∫—Ä—ã—Ç–∫–∞: {{ order.postcard_final_price }} ‚ÇΩ
                        {% if order.custom_postcard_image and order.postcard %}
                            <br><small style="color: #999;">(—Å–≤–æ—ë —Ñ–æ—Ç–æ + –æ—Å–Ω–æ–≤–∞ "{{ order.postcard.title }}")</small>
                        {% elif order.custom_postcard_image %}
                            <br><small style="color: #999;">(—Å–≤–æ—ë —Ñ–æ—Ç–æ)</small>
                        {% elif order.postcard %}
                            <br><small style="color: #999;">({{ order.postcard.title }})</small>
                        {% endif %}
                    </p>
                {% elif order.custom_postcard_image or order.postcard %}
                    <p style="margin: 5px 0; color: #28a745; font-size: 14px;">
                        –û—Ç–∫—Ä—ã—Ç–∫–∞: –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
                        {% if order.custom_postcard_image and order.postcard %}
                            <br><small style="color: #999;">(—Å–≤–æ—ë —Ñ–æ—Ç–æ + –æ—Å–Ω–æ–≤–∞ "{{ order.postcard.title }}")</small>
                        {% elif order.custom_postcard_image %}
                            <br><small style="color: #999;">(—Å–≤–æ—ë —Ñ–æ—Ç–æ)</small>
                        {% endif %}
                    </p>
                {% endif %}

                {% if order.delivery_cost > 0 %}
                    <p style="margin: 5px 0; color: #666; font-size: 14px;">–î–æ—Å—Ç–∞–≤–∫–∞: {{ order.delivery_cost }} ‚ÇΩ</p>
                {% endif %}

                <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #eee;">
                    <span style="font-size: 16px; color: #333; margin-right: 10px;">–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ:</span>
                    <span style="font-size: 26px; color: #e53935; font-weight: bold;">{{ order.get_total_cost }} ‚ÇΩ</span>
                </div>
            </div>

            <div style="text-align: center; margin-top: 40px;">
                <a href="{{ base_url }}{% url 'shop:cabinet' %}" style="background-color: #333; color: #ffffff; text-decoration: none; padding: 14px 30px; border-radius: 50px; font-weight: bold; font-size: 15px; display: inline-block;">
                    –°–ª–µ–¥–∏—Ç—å –∑–∞ –∑–∞–∫–∞–∑–æ–º
                </a>
            </div>

        </div>

        <div style="background-color: #f8f9fa; padding: 20px; text-align: center; font-size: 13px; color: #999; border-top: 1px solid #eee;">
            <p style="margin: 0;">–° –ª—é–±–æ–≤—å—é, –∫–æ–º–∞–Ω–¥–∞ {{ site_settings.shop_name }} üå∏</p>
            {% if site_settings.contact_phone %}
                <p style="margin: 5px 0 0;">{{ site_settings.contact_phone }}</p>
            {% endif %}
        </div>
    </div>
</body>
</html>
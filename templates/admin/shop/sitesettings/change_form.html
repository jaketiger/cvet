<!-- templates/admin/shop/sitesettings/change_form.html -->
{% extends "admin/change_form.html" %}
{% load i18n admin_urls static admin_modify %}

{# --- –°–¢–ò–õ–ò --- #}
{% block extrastyle %}
{{ block.super }}
<style>
    /* --- 1. –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –í–ù–ï–®–ù–ï–ì–û –í–ò–î–ê –†–£–ë–†–ò–ö --- */

    /* –£–±–∏—Ä–∞–µ–º –±–µ–ª—ã–µ "–∫–æ—Ä–æ–±–∫–∏" –≤–æ–∫—Ä—É–≥ –≥—Ä—É–ø–ø –ø–æ–ª–µ–π */
    .change-form .module {
        background: transparent !important;
        border: none !important;
        box-shadow: none !important;
        margin-bottom: 30px !important;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä—è–¥–æ–≤ –ø–æ–ª–µ–π - –£–ë–ò–†–ê–ï–ú –õ–ò–ù–ò–Æ –°–ù–ò–ó–£ */
    .change-form .form-row {
        border-bottom: none !important;
        padding: 12px 0 !important;
    }

    /* --- 2. –ó–ê–ì–û–õ–û–í–ö–ò –†–£–ë–†–ò–ö (–ö–û–ù–¢–†–ê–°–¢–ù–´–ï) --- */
    .change-form fieldset h2,
    .change-form .module h2 {
        color: #000000 !important;                 /* –¢–µ–∫—Å—Ç –ß–ï–†–ù–´–ô (–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç) */
        text-transform: uppercase !important;      /* –ó–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã */
        margin: 20px 0 15px 0 !important;
        border: none !important;                   /* –£–±–∏—Ä–∞–µ–º —Ä–∞–º–∫—É */
        border-bottom: 3px solid #417690 !important; /* –ñ–∏—Ä–Ω–∞—è —Å–∏–Ω—è—è –ª–∏–Ω–∏—è —Å–Ω–∏–∑—É –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è */
        box-shadow: none !important;
        letter-spacing: 1px;
    }

    /* –°—Å—ã–ª–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç—å/–°–∫—Ä—ã—Ç—å" */
    .change-form fieldset h2 a.collapse-toggle {
        color: #417690 !important;
        font-size: 12px !important;
        font-weight: normal !important;
        text-transform: none !important;
        margin-left: 15px;
        vertical-align: middle;
    }

    /* --- 3. –ü–ê–ù–ï–õ–¨ –ë–≠–ö–ê–ü–û–í --- */
    .backup-panel {
        background-color: #e8eaeb;
        border: 1px solid #ccc;
        margin-top: 60px;
        padding: 20px;
        border-radius: 6px;
        color: #333;
    }
    /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–Ω–µ–ª–∏ –±—ç–∫–∞–ø–æ–≤ */
    .backup-panel h2 {
        margin-top: 0 !important;
        padding: 0 !important;
        background: none !important;
        border: none !important;
        color: #333 !important;
        font-size: 16px !important;
        font-weight: bold !important;
        text-transform: none !important;
    }

    /* –ö–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–≤–µ—Ä—Ö—É */
    .top-submit-row {
        margin-bottom: 20px;
        padding: 15px 0;
        text-align: right;
        border-bottom: 1px solid #ccc;
    }

    /* –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è */
    .backup-alert {
        font-size: 13px;
        color: #333;
        margin-bottom: 20px;
        line-height: 1.5;
        background: #fff;
        padding: 15px;
        border-left: 5px solid #c62828;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .warning-text {
        color: #c62828;
        font-weight: bold;
    }

    /* –ö–Ω–æ–ø–∫–∏ –±—ç–∫–∞–ø–∞ */
    .backup-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
    }
    .backup-btn {
        display: inline-flex;
        align-items: center;
        padding: 10px 20px;
        text-decoration: none;
        border-radius: 4px;
        color: white !important;
        font-weight: bold;
        font-size: 13px;
        border: none;
        transition: opacity 0.2s;
    }
    .backup-btn:hover { opacity: 0.9; }

    .btn-db { background-color: #455a64; }
    .btn-media { background-color: #455a64; }
    .btn-env { background-color: #607d8b; }

    /* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */
    .backup-instructions {
        background-color: #fff;
        border: 1px solid #ccc;
        padding: 15px;
        border-radius: 4px;
    }
    .backup-instructions summary {
        cursor: pointer;
        font-weight: bold;
        color: #444;
    }
    .code-snippet {
        display: block;
        background: #2d2d2d;
        color: #f0f0f0;
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
        font-family: monospace;
        font-size: 12px;
        white-space: pre-wrap;
        border-left: 4px solid #4caf50;
    }
</style>
{% endblock %}




{# --- 1. –í–°–¢–ê–í–õ–Ø–ï–ú –ö–ù–û–ü–ö–ò –í –ù–ê–ß–ê–õ–û –§–û–†–ú–´ --- #}
{% block field_sets %}
    <div class="submit-row-top">
        {% submit_row %}
    </div>
    {{ block.super }}
{% endblock %}

{# --- 2. –ü–ê–ù–ï–õ–¨ –ë–≠–ö–ê–ü–û–í –í–ù–ò–ó–£ --- #}
{% block after_related_objects %}
    {{ block.super }}

    <div class="backup-panel">
        <h2>üì¶ –¶–µ–Ω—Ç—Ä –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è</h2>

        <details style="margin-bottom: 15px;">
            <summary>‚ÑπÔ∏è –ß—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ —ç—Ç–∏ —Ñ–∞–π–ª—ã? (–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å)</summary>
            <div class="backup-alert" style="margin-top: 10px; border-left: 5px solid #546e7a;">
                <ul style="padding-left: 20px; margin: 0;">
                    <li style="margin-bottom: 5px;"><strong>–ë–î (.dump):</strong> –¢–µ–∫—Å—Ç—ã, —Ç–æ–≤–∞—Ä—ã, —Ü–µ–Ω—ã, –∑–∞–∫–∞–∑—ã. <span class="warning-text">–ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–∞—Ä—Ç–∏–Ω–∫–∏!</span></li>
                    <li style="margin-bottom: 5px;"><strong>Media (.zip):</strong> –°–æ–¥–µ—Ä–∂–∏—Ç <strong>–ü–ê–ü–ö–£</strong> —Å–æ –≤—Å–µ–º–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏ —Ç–æ–≤–∞—Ä–æ–≤ –∏ –±–∞–Ω–Ω–µ—Ä—ã. <span class="warning-text">–°–∫–∞—á–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!</span></li>
                    <li style="margin-bottom: 5px;"><strong>–§–∞–π–ª .env:</strong> –°–æ–¥–µ—Ä–∂–∏—Ç –ø–∞—Ä–æ–ª–∏. <span class="warning-text">–í–ê–ñ–ù–û:</span> –ï—Å–ª–∏ —Å–∫–∞—á–∞–ª—Å—è –∫–∞–∫ <code>env</code> (–±–µ–∑ —Ç–æ—á–∫–∏), –ø–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ –≤ <code>.env</code>!</li>
                    <li><strong>Config (PM2):</strong> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (ecosystem.config.js).</li>
                </ul>
            </div>
        </details>

        <div class="backup-buttons">
            <a href="{% url 'admin:site_backup_db' %}" class="backup-btn btn-db">
                1. –°–∫–∞—á–∞—Ç—å –ë–î (.dump)
            </a>
            <a href="{% url 'admin:site_backup_media' %}" class="backup-btn btn-media">
                2. –°–∫–∞—á–∞—Ç—å Media (.zip)
            </a>
            <a href="{% url 'admin:site_backup_env' %}" class="backup-btn btn-env">
                3. –°–∫–∞—á–∞—Ç—å .env
            </a>
            <a href="{% url 'admin:site_backup_config' %}" class="backup-btn btn-env">
                4. –°–∫–∞—á–∞—Ç—å Config (PM2)
            </a>
        </div>

        <details class="backup-instructions">
            <summary>üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é (–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è)</summary>
            <div>
                <p style="margin-top: 10px; font-size: 13px;">–ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ —á–∏—Å—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–µ:</p>
                <ol style="padding-left: 20px; font-size: 13px; line-height: 1.6;">
                    <li>
                        <strong>–ö–æ–¥ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:</strong>
                        <div class="code-snippet">git clone https://github.com/username/repo.git /path/to/project
cd /path/to/project
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt</div>
                    </li>
                    <li>
                        <strong>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:</strong>
                        –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª <code>.env</code> –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞.
                    </li>
                    <li>
                        <strong>–ú–µ–¥–∏–∞-—Ñ–∞–π–ª—ã:</strong>
                        –†–∞—Å–ø–∞–∫—É–π—Ç–µ –∞—Ä—Ö–∏–≤ <strong>–ü–ê–ü–ö–£</strong> media –≤ <code>/path/to/project/media/</code>.
                    </li>
                    <li>
                        <strong>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:</strong>
                        <br>–°–æ–∑–¥–∞–π—Ç–µ –ø—É—Å—Ç—É—é –ë–î. –ù–µ –¥–µ–ª–∞–π—Ç–µ migrate. –í—ã–ø–æ–ª–Ω–∏—Ç–µ:
                        <div class="code-snippet">pg_restore --clean --no-acl --no-owner -U <db_user> -d <db_name> <backup_file>.dump</div>
                    </li>
                    <li>
                        <strong>–ó–∞–ø—É—Å–∫ –∏ –ø—Ä–∞–≤–∞:</strong>
                        <div class="code-snippet">python manage.py collectstatic --noinput
# –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ <your_linux_user> –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, www_jaketiger)
sudo chown -R <your_linux_user>:<your_linux_user> /path/to/project
sudo find /path/to/project/media -type d -exec chmod 755 {} \;
sudo find /path/to/project/media -type f -exec chmod 644 {} \;
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ PM2
pm2 restart ecosystem.config.js</div>
                    </li>
                </ol>
            </div>
        </details>
    </div>
{% endblock %}
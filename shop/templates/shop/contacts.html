<!-- shop/templates/shop/contacts.html -->
{% extends "base.html" %}

{% block title %}{{ custom_title }} - {{ site_settings.shop_name }}{% endblock %}

{% block content %}
<div class="contacts-page-wrapper fade-in-up">

    <!-- Заголовок страницы -->
    <div class="page-header">
        <h1 class="page-title">{{ custom_title }}</h1>
        <p class="page-subtitle">Мы всегда на связи и рады видеть вас в нашем магазине</p>
        <div class="header-line"></div>
    </div>

    <div class="contacts-grid">

        <!-- ЛЕВАЯ КОЛОНКА: ИНФОРМАЦИЯ -->
        <div class="info-column">

            <!-- 1. Адрес -->
            {% if site_settings.pickup_address %}
            <div class="contact-card">
                <div class="icon-box">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                </div>
                <div class="card-content">
                    <h3>{{ site_settings.contacts_address_title|default:'Наш адрес' }}</h3>
                    <p>{{ site_settings.pickup_address|linebreaksbr }}</p>
                </div>
            </div>
            {% endif %}

            <!-- 2. Телефон -->
            {% if site_settings.contact_phone or site_settings.contact_phone_secondary %}
            <div class="contact-card">
                <div class="icon-box">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                </div>
                <div class="card-content">
                    <h3>{{ site_settings.contacts_phone_title|default:'Позвоните нам' }}</h3>
                    <div class="phones-list">
                        {% if site_settings.contact_phone %}
                            <a href="tel:{{ site_settings.contact_phone|cut:' ' }}" class="phone-link">{{ site_settings.contact_phone }}</a>
                        {% endif %}
                        {% if site_settings.contact_phone_secondary %}
                            <a href="tel:{{ site_settings.contact_phone_secondary|cut:' ' }}" class="phone-link">{{ site_settings.contact_phone_secondary }}</a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- 3. Email -->
            {% if site_settings.contact_email %}
            <div class="contact-card">
                <div class="icon-box">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                </div>
                <div class="card-content">
                    <h3>Напишите нам</h3>
                    <a href="mailto:{{ site_settings.contact_email }}" class="phone-link">
                        {{ site_settings.contact_email }}
                    </a>
                </div>
            </div>
            {% endif %}

            <!-- 4. Режим работы (ОБНОВЛЕННАЯ ЛОГИКА) -->
            <div class="contact-card">
                <div class="icon-box">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                </div>
                <div class="card-content">
                    <h3>{{ site_settings.contacts_hours_title|default:'Режим работы' }}</h3>

                    <div class="work-hours-list">
                        <!-- Проверяем, совпадают ли часы работы в будни и выходные -->
                        {% if site_settings.work_weekdays_open == site_settings.work_weekend_open and site_settings.work_weekdays_close == site_settings.work_weekend_close %}
                            <!-- Вариант 1: Время одинаковое -->
                            <div class="wh-row">
                                <span class="wh-day">Ежедневно:</span>
                                <span class="wh-time">
                                    {{ site_settings.work_weekdays_open|time:"H:i" }} - {{ site_settings.work_weekdays_close|time:"H:i" }}
                                </span>
                            </div>
                        {% else %}
                            <!-- Вариант 2: Время разное -->
                            <div class="wh-row">
                                <span class="wh-day">Пн-Пт:</span>
                                <span class="wh-time">
                                    {{ site_settings.work_weekdays_open|time:"H:i" }} - {{ site_settings.work_weekdays_close|time:"H:i" }}
                                </span>
                            </div>
                            <div class="wh-row">
                                <span class="wh-day">Сб-Вс:</span>
                                <span class="wh-time">
                                    {{ site_settings.work_weekend_open|time:"H:i" }} - {{ site_settings.work_weekend_close|time:"H:i" }}
                                </span>
                            </div>
                        {% endif %}
                    </div>

                    <!-- Если заполнено старое текстовое поле для уточнений -->
                    {% if site_settings.working_hours %}
                        <p class="wh-note">{{ site_settings.working_hours|linebreaksbr }}</p>
                    {% endif %}
                </div>
            </div>

        </div>

        <!-- ПРАВАЯ КОЛОНКА: КАРТА -->
        {% if site_settings.map_embed_code %}
        <div class="map-column">
            <div class="map-wrapper">
                {{ site_settings.map_embed_code|safe }}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<style>
    /* Анимация появления */
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .fade-in-up { animation: fadeInUp 0.6s ease-out forwards; }

    .contacts-page-wrapper {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
        font-family: var(--default-font-family, sans-serif);
    }

    /* Заголовок */
    .page-header { text-align: center; margin-bottom: 50px; }
    .page-title { font-size: 2.5rem; margin: 0 0 10px 0; color: #333; font-weight: 700; }
    .page-subtitle { color: #666; font-size: 1.1rem; margin: 0; }
    .header-line { width: 60px; height: 4px; background: var(--accent-color, #e53935); margin: 20px auto 0; border-radius: 2px; }

    /* Сетка */
    .contacts-grid {
        display: grid;
        grid-template-columns: 1fr 1.2fr; /* Карта чуть шире */
        gap: 40px;
        /* ВАЖНО: Растягиваем колонки на одинаковую высоту */
        align-items: stretch;
    }

    /* Карточки контактов */
    .info-column {
        display: flex;
        flex-direction: column;
        gap: 20px;
        /* Занимает всю доступную высоту */
        height: 100%;
    }

    .contact-card {
        background: #fff;
        padding: 25px;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.03);
        border: 1px solid #f0f0f0;
        display: flex;
        align-items: flex-start;
        gap: 20px;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .contact-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.06);
    }

    .icon-box {
        width: 50px; height: 50px;
        background: #f9f9f9;
        border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        color: var(--accent-color, #e53935);
        flex-shrink: 0;
    }
    .icon-box svg { width: 24px; height: 24px; }

    .card-content { flex: 1; }
    .card-content h3 { margin: 0 0 8px 0; font-size: 1.1rem; color: #333; }
    .card-content p { margin: 0; color: #555; line-height: 1.6; }

    /* Ссылки */
    .phones-list { display: flex; flex-direction: column; gap: 5px; }
    .phone-link {
        font-size: 1.2rem;
        font-weight: 600;
        color: #333;
        text-decoration: none;
        transition: color 0.2s;
        word-break: break-all;
    }
    .phone-link:hover { color: var(--accent-color, #e53935); }

    /* Стили для блока времени работы */
    .work-hours-list { display: flex; flex-direction: column; gap: 6px; }
    .wh-row { display: flex; justify-content: space-between; width: 100%; max-width: 240px; color: #555; font-size: 1rem; border-bottom: 1px dashed #eee; padding-bottom: 2px; }
    .wh-row:last-child { border-bottom: none; }
    .wh-day { font-weight: 600; color: #333; }
    .wh-time { font-weight: 500; }
    .wh-note { margin-top: 10px; font-size: 0.85rem; color: #777; font-style: italic; }

    /* === КАРТА (ИСПРАВЛЕНИЕ ВЫСОТЫ) === */
    .map-column {
        height: 100%; /* Колонка занимает всю высоту сетки */
        min-height: 400px; /* Но не меньше 400px */
        display: flex;
        flex-direction: column;
    }

    .map-wrapper {
        flex: 1; /* Растягивается, занимая всё свободное место */
        position: relative; /* Важно для абсолютного позиционирования iframe */
        width: 100%;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        background: #f0f0f0;
    }

    /* Принудительно растягиваем iframe */
    .map-wrapper iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100% !important;
        height: 100% !important;
        border: none;
    }

    /* Адаптивность */
    @media (max-width: 900px) {
        .contacts-grid {
            grid-template-columns: 1fr; /* Одна колонка */
            gap: 30px;
        }
        /* На телефоне карта не растягивается бесконечно, а имеет фиксированную высоту */
        .map-column {
            height: auto;
            display: block;
        }
        .map-wrapper {
            height: 400px; /* Фиксированная высота для мобильных */
            position: relative; /* Возвращаем обычное поведение */
        }
        .map-wrapper iframe {
             position: absolute; /* Все равно абсолютно внутри wrapper */
        }
        .page-title { font-size: 2rem; }
    }
</style>
{% endblock %}
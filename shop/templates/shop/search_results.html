<!-- shop/templates/shop/search_results.html -->
{% extends "base.html" %}
{% load static %}

{% block title %}
    {% if query %}–ü–æ–∏—Å–∫: "{{ query }}"{% else %}–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤{% endif %} - {{ site_settings.shop_name }}
{% endblock %}

{% block content %}
<div class="container">
    <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
    <nav style="margin-bottom: 20px; font-size: 0.9em;">
        <a href="{% url 'shop:home' %}">–ì–ª–∞–≤–Ω–∞—è</a> &gt;
        <span>–ü–æ–∏—Å–∫</span>
    </nav>

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ñ–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
    <div style="margin-bottom: 30px;">
        <h1 style="margin-bottom: 20px; color: #333;">
            {% if query %}
                üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –¥–ª—è "{{ query }}"
            {% else %}
                üîç –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤
            {% endif %}
        </h1>

        <!-- –£–º–Ω–∞—è —Ñ–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
        <form method="get" action="{% url 'shop:search_results' %}" style="margin-bottom: 20px;">
            <div style="display: flex; max-width: 600px; position: relative;">
                <input type="text"
                       name="q"
                       id="search-input"
                       style="flex: 1; padding: 12px; border: 2px solid #007bff; border-radius: 8px 0 0 8px; font-size: 16px;"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Ä–æ–∑—ã, –±—É–∫–µ—Ç –Ω–µ–≤–µ—Å—Ç—ã, –∫–æ–º–Ω–∞—Ç–Ω—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è..."
                       value="{{ query }}"
                       autocomplete="off">
                <button type="submit" style="padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 0 8px 8px 0; cursor: pointer; font-size: 16px;">
                    –ù–∞–π—Ç–∏
                </button>
            </div>
            <div style="font-size: 0.8em; color: #666; margin-top: 5px;">
                üí° –ü–æ–∏—Å–∫ –ø–æ–Ω–∏–º–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º—ã —Å–ª–æ–≤: "—Ü–≤–µ—Ç–æ–∫", "—Ü–≤–µ—Ç—ã", "—Ü–≤–µ—Ç–∫–∞–º"
            </div>
        </form>

        {% if query %}
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∏—Å–∫–∞ -->
            <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong>–ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {{ products|length }}</strong>
                        {% if query %}
                            <span style="color: #666; margin-left: 10px;">
                                –ø–æ –∑–∞–ø—Ä–æ—Å—É "{{ query }}"
                            </span>
                        {% endif %}
                    </div>
                    {% if products|length > 0 %}
                    <div style="font-size: 0.9em; color: #666;">
                        üîÑ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
                    </div>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
    {% if query %}
        {% if products %}
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px;">
                {% for product in products %}
                <div class="product-card" style="border: 1px solid #e0e0e0; border-radius: 12px; padding: 20px; background: white; transition: all 0.3s ease;">
                    <a href="{{ product.get_absolute_url }}" style="text-decoration: none; color: inherit; display: block;">
                        <div style="height: 200px; overflow: hidden; border-radius: 8px; margin-bottom: 15px; position: relative;">
                            <img src="
                                {% if product.image %}
                                    {{ product.image.url }}
                                {% else %}
                                    {% static 'shop/img/no_image.png' %}
                                {% endif %}
                            " alt="{{ product.name }}"
                                 style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease;">
                            {% if product.rank %}
                            <div style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8em;">
                                —Ä–µ–ª: {{ product.rank|floatformat:2 }}
                            </div>
                            {% endif %}
                        </div>

                        <h3 style="margin: 0 0 10px 0; font-size: 1.1em; line-height: 1.4; min-height: 2.8em;">
                            {% if product.highlighted_name %}
                                {{ product.highlighted_name|safe }}
                            {% else %}
                                {{ product.name }}
                            {% endif %}
                        </h3>

                        <p style="color: #666; font-size: 0.9em; margin-bottom: 15px; line-height: 1.5; min-height: 4.5em;">
                            {% if product.highlighted_description %}
                                {{ product.highlighted_description|safe }}
                            {% else %}
                                {{ product.description|truncatewords:20 }}
                            {% endif %}
                        </p>

                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: auto;">
                            <span style="font-size: 1.3em; font-weight: bold; color: #e53935;">
                                {{ product.price }} ‚ÇΩ
                            </span>
                        </div>
                    </a>

                    <form action="{% url 'cart:cart_add' product.id %}" method="post" style="margin-top: 15px;">
                        {{ cart_product_form }}
                        {% csrf_token %}
                        <button type="submit"
                                style="width: 100%; padding: 12px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1em; transition: background 0.3s ease;">
                            üõí –í –∫–æ—Ä–∑–∏–Ω—É
                        </button>
                    </form>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <!-- –£–ª—É—á—à–µ–Ω–Ω—ã–π –±–ª–æ–∫ "–Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ" -->
            <div style="text-align: center; padding: 60px 20px;">
                <div style="max-width: 500px; margin: 0 auto;">
                    <div style="font-size: 4em; margin-bottom: 20px;">üîç</div>
                    <h3 style="color: #666; margin-bottom: 20px;">–ü–æ –∑–∞–ø—Ä–æ—Å—É "{{ query }}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>

                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: left; margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px;">üí° –°–æ–≤–µ—Ç—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞:</h4>
                        <ul style="color: #666; line-height: 1.6;">
                            <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è</li>
                            <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç—ã–µ —Å–ª–æ–≤–∞</li>
                            <li>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–∏–Ω–æ–Ω–∏–º—ã: "—Ä–æ–∑—ã" –≤–º–µ—Å—Ç–æ "—Ü–≤–µ—Ç—ã —Ä–æ–∑"</li>
                            <li>–ò—â–∏—Ç–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –≤ <a href="{% url 'shop:product_list_all' %}">–∫–∞—Ç–∞–ª–æ–≥–µ</a></li>
                        </ul>
                    </div>

                    <a href="{% url 'shop:product_list_all' %}"
                       style="display: inline-block; padding: 12px 24px; background: #007bff; color: white; text-decoration: none; border-radius: 6px; font-size: 1.1em;">
                        –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–æ–ª–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥
                    </a>
                </div>
            </div>
        {% endif %}
    {% else %}
        <!-- –ë–ª–æ–∫ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞—Ö–æ–¥–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞ -->
        <div style="text-align: center; padding: 60px 20px;">
            <div style="max-width: 500px; margin: 0 auto;">
                <div style="font-size: 4em; margin-bottom: 20px;">üîç</div>
                <h3 style="color: #666; margin-bottom: 15px;">–ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–∞–ª–æ–≥—É —Ç–æ–≤–∞—Ä–æ–≤</h3>
                <p style="color: #666; line-height: 1.6; margin-bottom: 30px;">
                    –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞, –æ–ø–∏—Å–∞–Ω–∏–µ –∏–ª–∏ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ –ø–æ–ª–µ –≤—ã—à–µ.
                    –ü–æ–∏—Å–∫ –ø–æ–Ω–∏–º–∞–µ—Ç —Ä—É—Å—Å–∫—É—é –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—é –∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –æ–ø–µ—á–∞—Ç–∫–∏.
                </p>

                <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                    <a href="{% url 'shop:product_list_all' %}"
                       style="padding: 10px 20px; background: #6c757d; color: white; text-decoration: none; border-radius: 6px;">
                        üìÇ –í–µ—Å—å –∫–∞—Ç–∞–ª–æ–≥
                    </a>
                    <a href="{% url 'shop:contacts' %}"
                       style="padding: 10px 20px; background: #17a2b8; color: white; text-decoration: none; border-radius: 6px;">
                        üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã
                    </a>
                </div>
            </div>
        </div>
    {% endif %}
</div>

<style>
.product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    border-color: #007bff;
}

.product-card:hover img {
    transform: scale(1.05);
}

.search-highlight {
    background-color: #fff3cd;
    padding: 0.1em 0.2em;
    border-radius: 3px;
    font-weight: bold;
    color: #856404;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .container {
        padding: 10px;
    }

    .product-card {
        padding: 15px;
    }

    h1 {
        font-size: 1.5em;
    }
}
</style>

<script>
// –ü—Ä–æ—Å—Ç—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-input');
    const examples = [
        '—Ä–æ–∑—ã –∫—Ä–∞—Å–Ω—ã–µ',
        '–±—É–∫–µ—Ç –Ω–µ–≤–µ—Å—Ç—ã',
        '–∫–æ–º–Ω–∞—Ç–Ω—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è',
        '–≥–æ—Ä—à–µ—á–Ω—ã–µ —Ü–≤–µ—Ç—ã',
        '–ø–æ–¥–∞—Ä–æ–∫ –Ω–∞ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è'
    ];

    let exampleIndex = 0;

    if (searchInput && !searchInput.value) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä—ã –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞
        function rotateExample() {
            searchInput.placeholder = '–ù–∞–ø—Ä–∏–º–µ—Ä: ' + examples[exampleIndex];
            exampleIndex = (exampleIndex + 1) % examples.length;
        }

        rotateExample();
        setInterval(rotateExample, 3000);
    }
});
</script>
{% endblock %}
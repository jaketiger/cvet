<!-- shop/templates/shop/product_detail.html -->

{% extends "base.html" %}
{% load static %}

{% block title %}{{ product.name }} - MegaCvet{% endblock %}

{% block content %}
    <div class="product-container">
        <div class="product-gallery">
            <div class="main-image">
                {% if product.image %}
                    <img id="main-product-image" src="{{ product.image.url }}" alt="{{ product.name }}">
                {% else %}
                    <img id="main-product-image" src="{% static 'shop/img/placeholder.png' %}" alt="Изображение отсутствует">
                {% endif %}
            </div>

            {% with all_images=product.images.all %}
                {% if product.image or all_images %}
                    <div class="thumbnails">
                        {% if product.image %}
                            <img src="{{ product.image_thumbnail.url }}" alt="Превью {{ product.name }}" class="thumbnail active" onclick="changeMainImage('{{ product.image.url }}', this)">
                        {% endif %}
                        {% for img in all_images %}
                            <img src="{{ img.image_thumbnail.url }}" alt="{{ img.alt_text|default:'Превью товара' }}" class="thumbnail" onclick="changeMainImage('{{ img.image.url }}', this)">
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}
        </div>

        <div class="product-info">
            <h1>{{ product.name }}</h1>
            <p class="price">{{ product.price }} руб.</p>

            {% if product.description_right %}
            <div class="description-right">
                <h3>{{ product.description_right_title|default:site_settings.product_description_right_title }}:</h3>
                <p>{{ product.description_right|linebreaksbr }}</p>
            </div>
            {% endif %}

            {% if product.stock > 0 %}
                <p class="stock-status in-stock">
                    <strong>Наличие:</strong> В наличии
                </p>
                <form action="{% url 'cart:cart_add' product.id %}" method="post">
                    {% csrf_token %}
                    {{ cart_product_form.quantity.label_tag }}
                    {{ cart_product_form.quantity }}
                    <br>
                    <button type="submit" class="add-to-cart-btn">Добавить в корзину</button>
                </form>
            {% else %}
                <p class="stock-status out-of-stock">
                    <strong>Наличие:</strong> Нет в наличии
                </p>
                <button class="add-to-cart-btn" disabled>Нет в наличии</button>
            {% endif %}

        </div>
    </div>

    {% if product.description_bottom %}
    <div class="description-bottom-container">
        <h3>{{ product.description_bottom_title|default:site_settings.product_description_bottom_title }}:</h3>
        <p>{{ product.description_bottom|linebreaksbr }}</p>
    </div>
    {% endif %}

    <a href="{% url 'shop:product_list_all' %}" class="back-link">← Вернуться в каталог</a>

    <script>
        function changeMainImage(newSrc, clickedThumbnail) {
            document.getElementById('main-product-image').src = newSrc;
            const thumbnails = document.querySelectorAll('.thumbnail');
            thumbnails.forEach(thumb => {
                thumb.classList.remove('active');
            });
            clickedThumbnail.classList.add('active');
        }
    </script>

    <!-- Встроенные стили ниже были удалены, чтобы использовались глобальные из main.css -->

{% endblock %}
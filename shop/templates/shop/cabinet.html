<!-- shop/templates/shop/cabinet.html -->
{% extends "base.html" %}
{% load static %}

{% block title %}–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç{% endblock %}

{% block content %}
<!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Å–∞–ª—é—Ç–∞ -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<div class="cabinet-wrapper fade-in-up">

    <!-- === 1. –ü–†–ò–í–ï–¢–°–¢–í–ï–ù–ù–´–ô –ë–ê–ù–ù–ï–† === -->
    <div class="welcome-banner">
        <div class="banner-content">
            {% if not orders %}
                <!-- –¢–µ–∫—Å—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                <h1 class="animate-text">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.first_name|default:user.username }}! üéâ</h1>
                <p>–ú—ã —Ä–∞–¥—ã, —á—Ç–æ –≤—ã —Ç–µ–ø–µ—Ä—å —Å –Ω–∞–º–∏. –í–∞—à —Ü–≤–µ—Ç–æ—á–Ω—ã–π –ø—É—Ç—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–¥–µ—Å—å.</p>
            {% else %}
                <!-- –¢–µ–∫—Å—Ç –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ -->
                <h1>–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º, {{ user.first_name|default:user.username }}! üëã</h1>
                <p>–†–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å —Å–Ω–æ–≤–∞. –í–æ—Ç –∏—Å—Ç–æ—Ä–∏—è –≤–∞—à–∏—Ö –ø–æ–∫—É–ø–æ–∫.</p>
            {% endif %}
        </div>
        <!-- –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ–Ω–∞ -->
        <div class="banner-decoration"></div>
    </div>

    <div class="cabinet-grid">

        <!-- === –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ü–†–û–§–ò–õ–ï === -->
        <div class="cabinet-sidebar">

            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞: –ú–æ–∏ –¥–∞–Ω–Ω—ã–µ -->
            <div class="info-card">
                <div class="card-header">
                    <h3>–ú–æ–∏ –¥–∞–Ω–Ω—ã–µ</h3>
                    <a href="{% url 'shop:profile_edit' %}" class="icon-link" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                    </a>
                </div>
                <div class="user-details">
                    <div class="user-avatar-placeholder">
                        {{ user.first_name|first|default:user.username|first|upper }}
                    </div>
                    <div class="detail-row">
                        <strong>{{ user.first_name }} {{ user.last_name }}</strong>
                    </div>
                    <div class="detail-row email">
                        {{ user.email }}
                    </div>
                    <div class="detail-row phone">
                        {{ user.profile.phone|default:"–¢–µ–ª–µ—Ñ–æ–Ω –Ω–µ —É–∫–∞–∑–∞–Ω" }}
                    </div>
                </div>
            </div>

            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞: –î–æ—Å—Ç–∞–≤–∫–∞ -->
            <div class="info-card">
                <div class="card-header">
                    <h3>–î–æ—Å—Ç–∞–≤–∫–∞</h3>
                    <a href="{% url 'shop:profile_edit' %}" class="icon-link" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                    </a>
                </div>
                <div class="address-details">
                    {% if user.profile.city or user.profile.address %}
                        <p class="addr-city">{{ user.profile.city }}</p>
                        <p class="addr-street">{{ user.profile.address }}</p>
                        <p class="addr-zip">{{ user.profile.postal_code }}</p>
                    {% else %}
                        <p class="text-muted">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ –µ—â–µ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω.</p>
                        <a href="{% url 'shop:profile_edit' %}" class="btn-text">–î–æ–±–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å ‚Üí</a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- === –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –ò–°–¢–û–†–ò–Ø –ó–ê–ö–ê–ó–û–í === -->
        <div class="cabinet-main">
            {% if orders %}
                <h2 class="section-title">–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h2>
                <div class="orders-list">
                    {% for order in orders %}
                        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–∫–∞–∑–∞ -->
                        <div class="order-card">
                            <div class="order-header">
                                <div class="order-id">
                                    <span class="label">–ó–∞–∫–∞–∑</span> #{{ order.id }}
                                </div>
                                <div class="order-date">{{ order.created|date:"d E Y" }}</div>
                            </div>

                            <div class="order-body">
                                <div class="order-status status-{{ order.status }}">
                                    {{ order.get_status_display }}
                                </div>
                                <div class="order-total">
                                    {{ order.get_total_cost }} ‚ÇΩ
                                </div>
                            </div>

                            <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –≤–µ—Å—å –±–ª–æ–∫ -->
                            <a href="{% url 'shop:order_detail' order.id %}" class="order-link-overlay"></a>
                        </div>
                    {% endfor %}
                </div>
            {% else %}

                <!-- === EMPTY STATE (–ù–ï–¢ –ó–ê–ö–ê–ó–û–í) === -->
                <div class="empty-welcome-state">
                    <div class="illustration">
                        üéÅ
                    </div>
                    <h2>–í–∞—à —Ü–≤–µ—Ç–æ—á–Ω—ã–π –ø—É—Ç—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è!</h2>
                    <p>–°–µ–π—á–∞—Å –≤–∞—à–∞ –∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –ø—É—Å—Ç–∞, –Ω–æ —ç—Ç–æ –æ—Ç–ª–∏—á–Ω—ã–π –ø–æ–≤–æ–¥ –≤—ã–±—Ä–∞—Ç—å —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –∏–¥–µ–∞–ª—å–Ω—ã–π –±—É–∫–µ—Ç –¥–ª—è —Å–µ–±—è –∏–ª–∏ –±–ª–∏–∑–∫–∏—Ö.</p>

                    <!-- –ö–ù–û–ü–ö–ê: –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã btn btn-primary -->
                    <a href="{% url 'shop:product_list_all' %}" class="btn btn-primary custom-btn-size">
                        –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥
                    </a>
                </div>

            {% endif %}
        </div>
    </div>
</div>

<!-- ================== –°–¢–ò–õ–ò CSS ================== -->
<style>
    /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è */
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .fade-in-up { animation: fadeInUp 0.6s ease-out forwards; }

    /* –û–±—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
    .cabinet-wrapper {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
        font-family: var(--default-font-family, sans-serif);
    }

    /* 1. –ë–ê–ù–ù–ï–† */
    .welcome-banner {
        background: linear-gradient(120deg, #ff9a9e 0%, #fecfef 100%);
        border-radius: 20px;
        padding: 40px;
        color: #fff;
        margin-bottom: 40px;
        position: relative;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(255, 154, 158, 0.3);
    }
    .welcome-banner h1 { margin: 0 0 10px 0; font-size: 2.2rem; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .welcome-banner p { margin: 0; font-size: 1.1rem; opacity: 0.95; }

    /* –î–µ–∫–æ—Ä –±–∞–Ω–Ω–µ—Ä–∞ */
    .banner-decoration {
        position: absolute; top: -50%; right: -10%;
        width: 300px; height: 300px;
        background: rgba(255,255,255,0.1);
        border-radius: 50%;
        pointer-events: none;
    }
    .banner-decoration::before {
        content: ""; position: absolute; top: 50%; left: -50%;
        width: 200px; height: 200px; background: rgba(255,255,255,0.15); border-radius: 50%;
    }

    /* 2. –°–ï–¢–ö–ê */
    .cabinet-grid {
        display: grid;
        grid-template-columns: 300px 1fr; /* –°–∞–π–¥–±–∞—Ä 300px, –æ—Å—Ç–∞–ª—å–Ω–æ–µ –∫–æ–Ω—Ç–µ–Ω—Ç */
        gap: 40px;
    }
    @media (max-width: 850px) {
        .cabinet-grid { grid-template-columns: 1fr; }
    }

    /* 3. –ö–ê–†–¢–û–ß–ö–ò (–°–∞–π–¥–±–∞—Ä) */
    .info-card {
        background: #fff;
        border: 1px solid #f0f0f0;
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.02);
    }
    .card-header {
        display: flex; justify-content: space-between; align-items: center;
        margin-bottom: 20px; border-bottom: 1px solid #f9f9f9; padding-bottom: 10px;
    }
    .card-header h3 { margin: 0; font-size: 1.1rem; color: #333; font-weight: 700; }

    .icon-link { color: #999; transition: color 0.2s; }
    .icon-link:hover { color: var(--accent-color, #e53935); }

    .user-avatar-placeholder {
        width: 60px; height: 60px; background: #f0f2f5; color: #333;
        border-radius: 50%; display: flex; align-items: center; justify-content: center;
        font-size: 1.5rem; font-weight: bold; margin-bottom: 15px;
    }

    .detail-row { margin-bottom: 5px; color: #333; }
    .detail-row.email { color: #777; font-size: 0.9rem; }
    .detail-row.phone { margin-top: 10px; font-weight: 500; }

    .address-details p { margin: 0 0 5px 0; color: #555; }

    /* –°—Å—ã–ª–∫–∏ */
    .btn-text {
        color: var(--accent-color, #e53935); text-decoration: none;
        font-size: 0.9rem; font-weight: 600; display: inline-block; margin-top: 10px;
    }
    .btn-text:hover { text-decoration: underline; }

    /* 4. –°–ü–ò–°–û–ö –ó–ê–ö–ê–ó–û–í (–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç) */
    .section-title { margin-top: 0; margin-bottom: 20px; font-size: 1.5rem; color: #222; font-weight: 700; }
    .orders-list { display: flex; flex-direction: column; gap: 15px; }

    .order-card {
        background: #fff; border: 1px solid #eee; border-radius: 12px;
        padding: 20px; position: relative; transition: all 0.2s;
        display: flex; justify-content: space-between; align-items: center;
    }
    .order-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.06); border-color: #ddd; }
    .order-link-overlay { position: absolute; inset: 0; cursor: pointer; }

    .order-id { font-weight: 700; font-size: 1.1rem; color: #333; }
    .order-id .label { font-weight: 400; color: #888; font-size: 0.9rem; }
    .order-date { color: #999; font-size: 0.85rem; margin-top: 4px; }

    .order-status {
        padding: 6px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;
        text-transform: uppercase; margin-bottom: 5px; text-align: right; display: inline-block;
    }
    /* –¶–≤–µ—Ç–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ */
    .status-created, .status-processing { background: #fff8e1; color: #f57c00; }
    .status-shipped { background: #e3f2fd; color: #1976d2; }
    .status-delivered { background: #e8f5e9; color: #388e3c; }
    .status-cancelled { background: #ffebee; color: #d32f2f; }

    .order-total { font-weight: 700; font-size: 1.2rem; color: #333; text-align: right; }

    /* 5. EMPTY STATE (–ù–ï–¢ –ó–ê–ö–ê–ó–û–í) */
    .empty-welcome-state {
        text-align: center;
        padding: 80px 20px;
        background: #fff;
        border-radius: 20px;
        border: 2px dashed #f0f0f0;
    }
    .illustration {
        font-size: 4rem; margin-bottom: 20px;
        animation: float 3s ease-in-out infinite;
    }
    @keyframes float {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }

    .empty-welcome-state h2 { font-size: 1.8rem; margin-bottom: 10px; color: #333; }
    .empty-welcome-state p { color: #666; max-width: 450px; margin: 0 auto 30px auto; line-height: 1.6; }

    /* --- –°–¢–ò–õ–ò –î–õ–Ø –ö–ù–û–ü–ö–ò (–†–ê–ó–ú–ï–† –ò –û–¢–°–¢–£–ü–´) --- */
    /* –¶–≤–µ—Ç–∞ –∏ —Ç–µ–Ω–∏ –ø–æ–¥—Ç—è–Ω—É—Ç—Å—è –∏–∑ –∫–ª–∞—Å—Å–∞ btn-primary –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ */
    .custom-btn-size {
        padding: 15px 40px;
        font-size: 1.1rem;
        font-weight: 600;
        display: inline-block;
        margin-top: 20px;
    }
</style>

<!-- ================== JAVASCRIPT: –°–ê–õ–Æ–¢ ================== -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –±–ª–æ–∫–∞ –ø—É—Å—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–∑–Ω–∞—á–∏—Ç, –Ω–æ–≤—ã–π —é–∑–µ—Ä)
        const welcomeBlock = document.querySelector('.empty-welcome-state');

        if (welcomeBlock) {
            // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
            setTimeout(() => {
                var duration = 7 * 1000; // –°–∞–ª—é—Ç –¥–ª–∏—Ç—Å—è 7 —Å–µ–∫—É–Ω–¥
                var animationEnd = Date.now() + duration;

                // –í–ê–ñ–ù–û: zIndex: 9999 –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–∫–∞–∑ –ü–û–í–ï–†–• –≤—Å–µ–≥–æ —Å–∞–π—Ç–∞
                var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 9999, useWorker: false };

                function randomInRange(min, max) {
                  return Math.random() * (max - min) + min;
                }

                var interval = setInterval(function() {
                  var timeLeft = animationEnd - Date.now();

                  if (timeLeft <= 0) {
                    return clearInterval(interval);
                  }

                  var particleCount = 100 * (timeLeft / duration);

                  // –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ —Å –¥–≤—É—Ö —Å—Ç–æ—Ä–æ–Ω —ç–∫—Ä–∞–Ω–∞
                  confetti(Object.assign({}, defaults, {
                      particleCount,
                      origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 }
                  }));
                  confetti(Object.assign({}, defaults, {
                      particleCount,
                      origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 }
                  }));
                }, 250);
            }, 500);
        }
    });
</script>
{% endblock %}
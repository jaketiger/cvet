{% extends "base.html" %}
{% load static %}

{% block title %}Личный кабинет{% endblock %}

{% block content %}
<div class="container" style="padding-top: 2rem; padding-bottom: 2rem;">

    <!-- Блок для отображения сообщений (например, "Профиль успешно обновлен!") -->
    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h1>Личный кабинет, {{ user.first_name|default:user.username }}!</h1>
        <!-- Ссылка на новую страницу редактирования -->
        <a href="{% url 'shop:profile_edit' %}" class="btn-primary">Редактировать профиль</a>
    </div>

    <hr>
    <h3>Ваша история заказов</h3>

    {% if orders %}
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th scope="col"># Заказа</th>
                        <th scope="col">Дата</th>
                        <th scope="col">Сумма</th>
                        <th scope="col">Статус</th>
                        <th scope="col">Статус оплаты</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in orders %}
                        <tr>
                            <td>{{ order.id }}</td>
                            <td>{{ order.created|date:"d.m.Y, H:i" }}</td>
                            <td>{{ order.get_total_cost }} руб.</td>
                            <td>{{ order.get_status_display }}</td>
                            <td>
                                {% if order.paid %}
                                    <span style="color: green;">Оплачен</span>
                                {% else %}
                                    <span style="color: red;">Ожидает оплаты</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p>У вас еще нет ни одного заказа.</p>
        <a href="{% url "shop:product_list_all" %}" class="btn-primary">Перейти к покупкам</a>
    {% endif %}
</div>

<style>
    .messages { padding-left: 0; list-style: none; }
    .messages .success { color: #155724; background-color: #d4edda; border: 1px solid #c3e6cb; padding: .75rem 1.25rem; margin-bottom: 1rem; border-radius: .25rem; }
    .messages .error { color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb; padding: .75rem 1.25rem; margin-bottom: 1rem; border-radius: .25rem; }
    .btn-primary { padding: 10px 15px; text-decoration: none; border-radius: 5px; background-color: #007bff; color: white; }
</style>
{% endblock %}
<!-- shop/templates/shop/order_detail.html -->

{% extends "base.html" %}
{% block title %}–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ #{{ order.id }}{% endblock %}
{% block content %}
<div class="container" style="max-width: 800px; padding-top: 2rem; padding-bottom: 2rem;">
    <h1>–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ #{{ order.id }}</h1>
    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> {{ order.get_status_display }}</p>

    <!-- –ë–ª–æ–∫ —Å –¥–µ—Ç–∞–ª—è–º–∏ –∑–∞–∫–∞–∑–∞ -->
    <div class="order-details-block">
        <h3>–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞:</h3>

        <table class="order-details-table">
            <thead>
                <tr>
                    <th>–¢–æ–≤–∞—Ä</th>
                    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                    <th>–¶–µ–Ω–∞</th>
                </tr>
            </thead>
            <tbody>
                {% for item in order.items.all %}
                    <tr>
                        <td>{{ item.product.name }}</td>
                        <td>{{ item.quantity }}</td>
                        <td>{{ item.get_cost }} —Ä—É–±.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- === –ë–õ–û–ö –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –û–¢–ö–†–´–¢–ö–ò === -->
        {% if order.postcard or order.custom_postcard_image or order.postcard_text %}
        <div class="postcard-details-block">
            <h4>–û—Ç–∫—Ä—ã—Ç–∫–∞ –∫ –∑–∞–∫–∞–∑—É</h4>

            <div class="postcard-container">
                <!-- 1. –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–∫–∏ -->
                {% if order.custom_postcard_image %}
                    <div class="postcard-image-box">
                        <span class="postcard-label">–ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ —Ñ–æ—Ç–æ:</span>
                        <a href="{{ order.custom_postcard_image.url }}" target="_blank">
                            <img src="{{ order.custom_postcard_image.url }}" alt="–°–≤–æ—è –æ—Ç–∫—Ä—ã—Ç–∫–∞" class="postcard-img">
                        </a>
                    </div>
                {% elif order.postcard %}
                    <div class="postcard-image-box">
                        <span class="postcard-label">{{ order.postcard.title }} ({{ order.postcard.price }} —Ä—É–±.)</span>
                        {% if order.postcard.image %}
                            <img src="{{ order.postcard.image.url }}" alt="{{ order.postcard.title }}" class="postcard-img">
                        {% endif %}
                    </div>
                {% endif %}

                <!-- 2. –¢–µ–∫—Å—Ç –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è -->
                {% if order.postcard_text %}
                    <div class="postcard-text-box">
                        <span class="postcard-label">–¢–µ–∫—Å—Ç –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è:</span>
                        <div class="postcard-message">
                            {{ order.postcard_text|linebreaksbr }}
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
        <!-- === –ö–û–ù–ï–¶ –ë–õ–û–ö–ê –û–¢–ö–†–´–¢–ö–ò === -->

        <div class="order-summary-footer">
            <p>–°—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–æ–≤: {{ order.get_items_cost }} —Ä—É–±.</p>
            <p>–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏: {{ order.delivery_cost }} —Ä—É–±.</p>

            {% if order.postcard and order.postcard.price > 0 %}
                <p style="color: green;">+ –û—Ç–∫—Ä—ã—Ç–∫–∞: {{ order.postcard.price }} —Ä—É–±.</p>
            {% endif %}

            <h4>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ: {{ order.get_total_cost }} —Ä—É–±.</h4>
        </div>

        <hr>

        {% if order.delivery_option == 'delivery' %}
            <hr>
            <h4>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ</h4>

            <!-- –ë–ª–æ–∫ –ø–æ–ª—É—á–∞—Ç–µ–ª—è -->
            {% if order.recipient_name %}
                <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-bottom: 10px; color: #856404;">
                    <strong>üéÅ –ü–æ–ª—É—á–∞—Ç–µ–ª—å (–¥—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫):</strong><br>
                    –ò–º—è: {{ order.recipient_name }}<br>
                    –¢–µ–ª–µ—Ñ–æ–Ω: {{ order.recipient_phone }}
                </div>
            {% else %}
                <p style="color: #666;">–ü–æ–ª—É—á–∞—Ç–µ–ª—å: –í—ã ({{ order.phone }})</p>
            {% endif %}

            <p>
                <strong>–ê–¥—Ä–µ—Å:</strong><br>
                {{ order.postal_code }}, {{ order.city }}<br>
                {{ order.address }}
            </p>
        {% else %}
            <hr>
            <h4>–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è</h4>
            <p>–°–∞–º–æ–≤—ã–≤–æ–∑. –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É {{ order.phone }}, –∫–æ–≥–¥–∞ –∑–∞–∫–∞–∑ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ.</p>
        {% endif %}
    </div>

    <!-- –ë–ª–æ–∫ –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞ (–ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ —É—Å–ª–æ–≤–∏—é) -->
    {% if order.can_be_cancelled %}
        <hr>
        <div class="cancel-zone">
            <h4>–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞</h4>
            <p>–í—ã –º–æ–∂–µ—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —ç—Ç–æ—Ç –∑–∞–∫–∞–∑. –í—Å–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –Ω–µ–≥–æ –±—É–¥—É—Ç –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã –≤ –≤–∞—à—É –∫–æ—Ä–∑–∏–Ω—É, –ø–æ—Å–ª–µ —á–µ–≥–æ –≤—ã —Å–º–æ–∂–µ—Ç–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–µ –∏ –æ—Ñ–æ—Ä–º–∏—Ç—å –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑.</p>
            <form action="{% url 'shop:cancel_order' order.id %}" method="post" style="margin-top: 15px;">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —ç—Ç–æ—Ç –∑–∞–∫–∞–∑?')">–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑</button>
            </form>
        </div>
    {% endif %}

    <!-- –°—Å—ã–ª–∫–∞ "–ù–∞–∑–∞–¥" –≤ –≤–∏–¥–µ –∫–Ω–æ–ø–∫–∏ -->
    <a href="{% url 'shop:cabinet' %}" class="btn btn-secondary back-to-cabinet-btn">‚Üê –ù–∞–∑–∞–¥ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
</div>
{% endblock %}
<!-- shop/templates/shop/order_detail.html -->

{% extends "base.html" %}
{% block title %}Детали заказа #{{ order.id }}{% endblock %}
{% block content %}
<div class="container" style="max-width: 800px; padding-top: 2rem; padding-bottom: 2rem;">
    <h1>Детали заказа #{{ order.id }}</h1>
    <p><strong>Статус:</strong> {{ order.get_status_display }}</p>

    <!-- Блок с деталями заказа -->
    <div style="text-align: left; margin-top: 30px; background-color: #f9f9f9; padding: 20px; border-radius: 5px;">
        <h3>Детали заказа:</h3>

        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr>
                    <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Товар</th>
                    <th style="border: 1px solid #ddd; padding: 8px;">Количество</th>
                    <th style="border: 1px solid #ddd; padding: 8px;">Цена</th>
                </tr>
            </thead>
            <tbody>
                {% for item in order.items.all %}
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 8px;">{{ item.product.name }}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">{{ item.quantity }}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: right;">{{ item.get_cost }} руб.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <div style="text-align: right; margin-top: 20px;">
            <p style="margin: 5px 0;">Стоимость доставки: {{ order.delivery_cost }} руб.</p>
            <h4 style="margin-top: 10px;">Итого к оплате: {{ order.get_total_cost }} руб.</h4>
        </div>

        <hr>

        {% if order.delivery_option == 'delivery' %}
            <h4>Адрес доставки</h4>
            <p>
                {{ order.postal_code }}, {{ order.city }}<br>
                {{ order.address }}<br>
                Телефон: {{ order.phone }}
            </p>
        {% else %}
            <h4>Способ получения</h4>
            <p>Самовывоз. Мы свяжемся с вами, когда заказ будет готов к выдаче.</p>
        {% endif %}
    </div>

    <!-- Блок отмены заказа (появляется по условию) -->
    {% if order.can_be_cancelled %}
        <hr>
        <div class="cancel-zone">
            <h4>Изменение или отмена заказа</h4>
            <p>Вы можете отменить этот заказ. Все товары из него будут возвращены в вашу корзину, после чего вы сможете отредактировать ее и оформить новый заказ.</p>
            <form action="{% url 'shop:cancel_order' order.id %}" method="post" style="margin-top: 15px;">
                {% csrf_token %}
                <!-- Кнопка "Отменить" с новыми классами -->
                <button type="submit" class="btn btn-danger" onclick="return confirm('Вы уверены, что хотите отменить этот заказ?')">Отменить заказ</button>
            </form>
        </div>
    {% endif %}

    <!-- Ссылка "Назад" в виде кнопки -->
    <a href="{% url 'shop:cabinet' %}" class="btn btn-secondary" style="margin-top: 30px;">← Назад в личный кабинет</a>
</div>

<style>
    /* --- СТИЛИ ДЛЯ КНОПОК, СКОПИРОВАННЫЕ ИЗ CABINET.HTML ДЛЯ ЕДИНООБРАЗИЯ --- */

    /* Базовый стиль: размер, отступы, шрифт */
    .btn {
        display: inline-block;
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        text-decoration: none;
        color: white;
        font-size: 16px; /* Можно сделать чуть побольше на этой странице */
        font-family: inherit;
        cursor: pointer;
        text-align: center;
        margin: 5px 0;
        vertical-align: middle;
    }

    /* Красная кнопка (опасное действие) */
    .btn-danger {
        background-color: #dc3545;
    }
    .btn-danger:hover {
        background-color: #c82333;
    }

    /* Серая кнопка (второстепенное действие) */
    .btn-secondary {
        background-color: #6c757d;
    }
    .btn-secondary:hover {
        background-color: #5a6268;
    }
</style>
{% endblock %}
<!-- shop/templates/shop/home.html -->
{% extends "base.html" %}
{% load static %}

{% block title %}{{ site_settings.shop_name }} - Главная{% endblock %}

{% block content %}
    {% if banners %}
    <div class="swiper-container">
        <div class="swiper-wrapper">
            {% for banner in banners %}
                {% if banner.link and not banner.button_text %}
                    <a href="{{ banner.link }}" class="swiper-slide" style="background-image: url('{{ banner.image.url }}');">
                {% else %}
                    <div class="swiper-slide" style="background-image: url('{{ banner.image.url }}');">
                {% endif %}
                        <div class="slide-content-wrapper pos-{{ banner.content_position }}">
                            {% if banner.title or banner.subtitle or banner.button_text %}
                                <div class="slide-content" style="
                                    background-color: rgba(0, 0, 0, {{ banner.background_opacity_css }});
                                    color: {{ banner.font_color|default:'#FFFFFF' }};
                                    border-radius: {{ banner.background_border_radius }}px;
                                    {% if banner.add_text_shadow %}text-shadow: 1px 1px 3px rgba(0,0,0,0.5);{% endif %}
                                    font-family: {% with font=banner.font_family|default:'roboto' %}{% if font == 'roboto' %}'Roboto', sans-serif{% elif font == 'montserrat' %}'Montserrat', sans-serif{% elif font == 'open-sans' %}'Open Sans', sans-serif{% elif font == 'lora' %}'Lora', serif{% elif font == 'merriweather' %}'Merriweather', serif{% elif font == 'playfair-display' %}'Playfair Display', serif{% elif font == 'lobster' %}'Lobster', cursive{% elif font == 'pacifico' %}'Pacifico', cursive{% else %}'Roboto', sans-serif{% endif %}{% endwith %};
                                ">
                                    {% if banner.title %}<h1 style="font-size: {{ banner.title_font_size }}px;">{{ banner.title }}</h1>{% endif %}
                                    {% if banner.subtitle %}<p style="font-size: {{ banner.subtitle_font_size }}px;">{{ banner.subtitle }}</p>{% endif %}
                                    {% if banner.link and banner.button_text %}
                                        <a href="{{ banner.link }}" class="slide-btn" style="
                                            background-color: {{ banner.button_color }};
                                            color: {{ banner.button_text_color }};
                                        ">{{ banner.button_text }}</a>
                                    {% endif %}
                                </div>
                            {% endif %}
                        </div>
                {% if banner.link and not banner.button_text %}
                    </a>
                {% else %}
                    </div>
                {% endif %}
            {% endfor %}
        </div>
        <div class="swiper-pagination"></div><div class="swiper-button-prev"></div><div class="swiper-button-next"></div>
    </div>
    {% endif %}

    <h2 style="text-align: center; margin: 40px 0;">Популярные букеты</h2>
    <div class="product-grid">
        {% for product in featured_products %}
            <div class="product-card">
                <a href="{{ product.get_absolute_url }}">{% if product.image_thumbnail %}<img src="{{ product.image_thumbnail.url }}" alt="{{ product.name }}">{% endif %}</a>
                <h2><a href="{{ product.get_absolute_url }}">{{ product.name }}</a></h2><p class="price">{{ product.price }} руб.</p>
                <form action="{% url 'cart:cart_add' product.id %}" method="post">{% csrf_token %}<input type="hidden" name="quantity" value="1"><input type="hidden" name="update" value="False"><input type="submit" value="В корзину" class="add-to-cart-btn-small"></form>
            </div>
        {% empty %}
            <p style="text-align: center;">Избранных товаров пока нет. Отметьте их в админ-панели.</p>
        {% endfor %}
    </div>
{% endblock %}

{% block extra_scripts %}
    <script>
      const swiper = new Swiper('.swiper-container', {
        autoplay: { delay: {{ site_settings.slider_duration|default:5 }} * 1000, disableOnInteraction: false, },
        effect: '{{ site_settings.slider_effect|default:"slide" }}',
        loop: true,
        navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev', },
        pagination: { el: '.swiper-pagination', clickable: true, },
        cubeEffect: { shadow: true, slideShadows: true, shadowOffset: 20, shadowScale: 0.94, },
      });
    </script>
{% endblock %}